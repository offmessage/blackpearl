

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example 1: Simple interactive light show &mdash; Black Pearl 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Black Pearl 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Examples" href="index.html"/>
        <link rel="next" title="Example 2: Making a thermometer" href="example_2.html"/>
        <link rel="prev" title="Examples" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Black Pearl
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Detailed installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting started with blackpearl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messages.html">Messages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example 1: Simple interactive light show</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-by-step-example">Step by step example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-the-code-neater">Making the code neater</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="example_2.html">Example 2: Making a thermometer</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_3.html">Example 3: Matching colours</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_4.html">Example 4: Mighty Mover</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_5.html">Example 5: The Simple Stopwatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_5_2.html">Example 5 (part 2): A more complex stopwatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="plannedexamples.html">Planned examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examplesbykit.html">Examples broken down by kit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/index.html">Flotilla hardware things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html"><strong>blackpearl</strong>&#8216;s software things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blackpearl/index.html"><strong>blackpearl</strong>&#8216;s internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingidle.html">Using IDLE with <strong>blackpearl</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting your installation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Black Pearl</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Examples</a> &raquo;</li>
      
    <li>Example 1: Simple interactive light show</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/example_1.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-1-simple-interactive-light-show">
<span id="example1"></span><h1>Example 1: Simple interactive light show<a class="headerlink" href="#example-1-simple-interactive-light-show" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Like the getting started example, this project uses the touch keypad
and rainbow LEDs, so it&#8217;ll work with the Mini Starter Kit.</p>
</div>
<div class="section" id="step-by-step-example">
<h2>Step by step example<a class="headerlink" href="#step-by-step-example" title="Permalink to this headline">¶</a></h2>
<p>Our first example project (in <a class="reference internal" href="../gettingstarted.html"><span class="doc">Getting started with blackpearl</span></a>) made the rainbow LEDs
change colour depending on the button that was pressed (red for button 1, green
for button 2, blue for button 3 and nothing for button 4).</p>
<p>This time we want only one LED to light up at a time, and have that change
every time someone presses button 1. And we want to change the colour every time
someone presses button 2.</p>
<p>This example can be found in
<a class="reference external" href="https://github.com/offmessage/blackpearl/blob/master/blackpearl/examples/example_1.py">blackpearl/examples/example_1.py</a>,
but it&#8217;s also included here in its entirety for reference:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blackpearl.modules</span> <span class="k">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">blackpearl.projects</span> <span class="k">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">blackpearl.things</span> <span class="k">import</span> <span class="n">Rainbow</span>
<span class="kn">from</span> <span class="nn">blackpearl.things</span> <span class="k">import</span> <span class="n">Touch</span>


<span class="k">class</span> <span class="nc">TouchTheRainbow</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">listening_for</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">,]</span>
    <span class="n">hardware_required</span> <span class="o">=</span> <span class="p">[</span><span class="n">Touch</span><span class="p">,</span> <span class="n">Rainbow</span><span class="p">,]</span>

    <span class="n">button1_press_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">button2_press_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">colours</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span>
               <span class="p">]</span>

    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">][</span><span class="s1">&#39;buttons&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">colour_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">%</span> <span class="mi">9</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">[</span><span class="n">colour_index</span><span class="p">]</span>

            <span class="n">active_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">%</span> <span class="mi">5</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">set_pixel</span><span class="p">(</span><span class="n">active_pixel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">colour_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">%</span> <span class="mi">9</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">[</span><span class="n">colour_index</span><span class="p">]</span>

            <span class="n">active_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">%</span> <span class="mi">5</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">set_pixel</span><span class="p">(</span><span class="n">active_pixel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">MyProject</span><span class="p">(</span><span class="n">Project</span><span class="p">):</span>
    <span class="n">required_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">TouchTheRainbow</span><span class="p">,]</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">MyProject</span><span class="p">()</span>
</pre></div>
</div>
<p>This project remembers the state of the rainbow each time a button is pressed
and changes it the next time a button is pressed. This ability to remembering
is because we&#8217;ve used Python classes to wrap the functionality of the hardware,
and can store the state of the hardware in those classes.</p>
<p>As with the <a class="reference internal" href="../gettingstarted.html#gettingstarted-example"><span class="std std-ref">Getting Started example</span></a> the first
thing we need to do is import all the necessary bits and bobs. These are the
basic <code class="docutils literal"><span class="pre">Project</span></code>, the basic <code class="docutils literal"><span class="pre">Module</span></code> and the <code class="docutils literal"><span class="pre">Rainbow</span></code> and <code class="docutils literal"><span class="pre">Touch</span></code>
<em>things</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blackpearl.modules</span> <span class="k">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">blackpearl.projects</span> <span class="k">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">blackpearl.things</span> <span class="k">import</span> <span class="n">Rainbow</span>
<span class="kn">from</span> <span class="nn">blackpearl.things</span> <span class="k">import</span> <span class="n">Touch</span>
</pre></div>
</div>
<p>As before we define our own module, using <strong>blackpearl</strong>&#8216;s <strong>Module</strong> class as
our base class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TouchTheRainbow</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
</pre></div>
</div>
<p>And as before we are listening for button presses from the touch keypad, and
need both the touch keypad and the rainbow LEDs for our module to work:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">listening_for</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">,]</span>
<span class="n">hardware_required</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rainbow</span><span class="p">,</span> <span class="n">Touch</span><span class="p">,]</span>
</pre></div>
</div>
<p>We also define some new things that are unique to this module; we want to keep
count of how many times button 1 and button 2 have been pressed. To do this
we define new <em>attributes</em> of our module class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">button1_press_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">button2_press_count</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>We also want a list of colours to cycle through, so we define that as an
attribute too:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">colours</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span>
           <span class="p">]</span>
</pre></div>
</div>
<p>The main difference with this module is our <code class="docutils literal"><span class="pre">.receive()</span></code> method, as we want
to do something different when a button is pressed.</p>
<p>Remember, our <code class="docutils literal"><span class="pre">.receive()</span></code> method is only called when a button has been
pressed or released, because we&#8217;re only listening for messages from the touch
(which we defined in our <code class="docutils literal"><span class="pre">listening_for</span></code>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="c1"># We&#39;re listening for buttons!</span>
    <span class="n">buttons</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">][</span><span class="s1">&#39;buttons&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The first thing we do is take some actions when button 1 is pressed. In this
case we want to add 1 to our counter that tells us how many times it&#8217;s been
pressed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The next line works out which member of the colour list to use. We do this
using the <code class="docutils literal"><span class="pre">%</span></code> operator. This is the <strong>remainder</strong> operator. So <code class="docutils literal"><span class="pre">5%2</span></code> is
<code class="docutils literal"><span class="pre">1</span></code> (because 5/2 is 2 <em>remainder</em> 1). By using this operator we ensure that
however big our button counts get we&#8217;ll always end up with a number that is
between 0 and 8 which we can use to get a colour from our list (which, because
computers start from 0, is number 0 to 8 too).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">colour_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">%</span> <span class="mi">9</span>
</pre></div>
</div>
<p>Next we get the red green and blue colour values from our selected colour.
In Python it&#8217;s possible to access the <em>nth</em> item in a list (remembering that
computers start counting at zero) by saying <code class="docutils literal"><span class="pre">list[n]</span></code>. So to get the word
&#8220;two&#8221; from the list <code class="docutils literal"><span class="pre">mylist</span> <span class="pre">=</span> <span class="pre">['zero',</span> <span class="pre">'one',</span> <span class="pre">'two',</span> <span class="pre">'three',]</span></code> we can say
<code class="docutils literal"><span class="pre">mylist[2]</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">[</span><span class="n">colour_index</span><span class="p">]</span>
</pre></div>
</div>
<p>Using the same process (the <code class="docutils literal"><span class="pre">%</span></code> operator) we can calculate which LED to light
up. We know there are 5 LEDs on the rainbow, so we get the remainder by
dividing by 5, which will give us a number between 0 and 4.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">active_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">%</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Now we have all the values that we need we can use them to manipulate the
rainbow LEDs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">set_pixel</span><span class="p">(</span><span class="n">active_pixel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
<p>The code above resets the rainbow (sets all the LEDs to <em>off</em>) and then sets
the colour of only the one we want to the colour from our list.</p>
<p>The code for when button 2 is pressed is exactly the same, except we add one
to the counter we&#8217;re storing for button 2 presses instead:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">colour_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">%</span> <span class="mi">9</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">[</span><span class="n">colour_index</span><span class="p">]</span>

    <span class="n">active_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">%</span> <span class="mi">5</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">set_pixel</span><span class="p">(</span><span class="n">active_pixel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
<p>As before, the rest of the script is the bit that makes the whole thing run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyProject</span><span class="p">(</span><span class="n">Project</span><span class="p">):</span>
    <span class="n">required_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">TouchTheRainbow</span><span class="p">,]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">MyProject</span><span class="p">()</span>
</pre></div>
</div>
<p>Now our project will run from within our virtual environment as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">blackpearl</span>
<span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">python</span> <span class="n">blackpearl</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">example_1</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="making-the-code-neater">
<h2>Making the code neater<a class="headerlink" href="#making-the-code-neater" title="Permalink to this headline">¶</a></h2>
<p>Some of you will have noticed a couple of things about our project:</p>
<blockquote>
<div><ul class="simple">
<li>Firstly, there&#8217;s a lot of code that repeats itself. Most of what&#8217;s done in
the two <code class="docutils literal"><span class="pre">if</span></code> statements is exactly the same, and</li>
<li>Secondly, nothing happens until we press a button, which means that the
first LED to light up is the second one, not the first</li>
</ul>
</div></blockquote>
<p>Let&#8217;s address the first thing. We can break the repeated code out into
it&#8217;s own method, so that if we want to change it we only have to change it
in one place, and we know that if it works for one it will work for the other.</p>
<p>We do this by defining a new method (which I&#8217;ve called <code class="docutils literal"><span class="pre">.update_rainbow()</span></code>)
that has all the repeated code in:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_rainbow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="n">colour_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">)</span>
  <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">[</span><span class="n">colour_index</span><span class="p">]</span>

  <span class="n">active_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">%</span> <span class="mi">5</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">set_pixel</span><span class="p">(</span><span class="n">active_pixel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also see that instead of doing <code class="docutils literal"><span class="pre">%</span> <span class="pre">9</span></code> to get the <code class="docutils literal"><span class="pre">colour_index</span></code> I&#8217;ve
changed it to be <code class="docutils literal"><span class="pre">len(self.colours)</span></code>. This means that if you change the number
of colours in the <code class="docutils literal"><span class="pre">self.colours</span></code> list the calculation will always work
(because the Python <code class="docutils literal"><span class="pre">len()</span></code> function returns the length of a list).</p>
<p>Now our button press code can be much simpler:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
  <span class="n">buttons</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">][</span><span class="s1">&#39;buttons&#39;</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">update_rainbow</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">update_rainbow</span><span class="p">()</span>
</pre></div>
</div>
<p>(In Python <code class="docutils literal"><span class="pre">foo</span> <span class="pre">+=</span> <span class="pre">1</span></code> is a shortcut for <code class="docutils literal"><span class="pre">foo</span> <span class="pre">=</span> <span class="pre">foo</span> <span class="pre">+</span> <span class="pre">1</span></code>).</p>
<p>We can address the second point because modules define a method called
<code class="docutils literal"><span class="pre">.setup()</span></code> that is called when a new instance of the module is created. We can
use this to get the first LED lit up with the first colour by calling our new
<code class="docutils literal"><span class="pre">.update_rainbow()</span></code> method from the <code class="docutils literal"><span class="pre">.setup()</span></code> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">update_rainbow</span><span class="p">()</span>
</pre></div>
</div>
<p>This code works exactly the same way as the example at the top, but is much
neater and addresses both of our points (plus a couple of others along the
way):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blackpearl.modules</span> <span class="k">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">blackpearl.projects</span> <span class="k">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">blackpearl.things</span> <span class="k">import</span> <span class="n">Rainbow</span>
<span class="kn">from</span> <span class="nn">blackpearl.things</span> <span class="k">import</span> <span class="n">Touch</span>


<span class="k">class</span> <span class="nc">TouchTheRainbow</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">listening_for</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">,]</span>
    <span class="n">hardware_required</span> <span class="o">=</span> <span class="p">[</span><span class="n">Touch</span><span class="p">,</span> <span class="n">Rainbow</span><span class="p">,]</span>

    <span class="n">button1_press_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">button2_press_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">colours</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">204</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">51</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">102</span><span class="p">),</span>
               <span class="p">]</span>

    <span class="k">def</span> <span class="nf">update_rainbow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">colour_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">[</span><span class="n">colour_index</span><span class="p">]</span>

        <span class="n">active_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">%</span> <span class="mi">5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">set_pixel</span><span class="p">(</span><span class="n">active_pixel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rainbow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;touch&#39;</span><span class="p">][</span><span class="s1">&#39;buttons&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button1_press_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_rainbow</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button2_press_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_rainbow</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_rainbow</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">MyProject</span><span class="p">(</span><span class="n">Project</span><span class="p">):</span>
    <span class="n">required_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">TouchTheRainbow</span><span class="p">,]</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">MyProject</span><span class="p">()</span>
</pre></div>
</div>
<p>This updated, neater, example can be found in
<a class="reference external" href="https://github.com/offmessage/blackpearl/blob/master/blackpearl/examples/example_1_2.py">blackpearl/examples/example_1_2.py</a>,</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example_2.html" class="btn btn-neutral float-right" title="Example 2: Making a thermometer" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Examples" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Andy Theyers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>